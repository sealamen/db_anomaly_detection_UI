import streamlit as st
import pandas as pd

st.set_page_config(page_title="λ¨λΈ μ„¤λ…", layout="wide")

st.title("π“ λ¨λΈ ")
st.markdown("\n")
st.markdown("\n")

# --- νƒ­ μƒμ„± ---
tab1, tab2, tab3 = st.tabs(["1. ν•™μµ λ¨λΈ μ„¤λ…", "2. ν‰κ°€ κΈ°μ¤€", "3. ν•μ΄νΌνλΌλ―Έν„° νλ‹"])

with tab1:
    st.markdown("\n")
    st.markdown("""
    ### 1. λ¨λΈ λ©λ΅

    """)

with tab2:
    st.markdown("\n")
    st.markdown("""
    ### 2. ν‰κ°€ κΈ°μ¤€ 
    """)
    st.markdown("\n")

    st.markdown("""
    ##### μ΄μƒμΉ νλ‹¨ κΈ°μ¤€
    - μ„Έ λ¨λΈμ κ³Όλ°μ ν¬ν‘λ¥Ό ν†µν•΄ μ΄μƒμΉ νλ‹¨
    - ex :  IF β†’ 1 , OCSVM β†’ 0, AE β†’ 0
        - Final Alert: 1
    """)

    st.markdown("\n")
    st.markdown("""
    ##### λ¨λΈ ν‰κ°€ κΈ°μ¤€ : μ„±λ¥ν‰κ°€μ§€ν‘ μ‚¬μ© 
    - μ΄μ ν™κ²½μ—μ„λ” **Recall(μ¬ν„μ¨)μ„ μ°μ„ **, κ·Έλ‹¤μ Precision ν™•μΈ, μµμΆ…μ μΌλ΅ F1-scoreλ¥Ό μ§€ν‘λ΅ μ‚Όλ” κ² κ°€μ¥ ν•©λ¦¬μ 
        - Recall : μ‹¤μ  μ΄μƒ μ¤‘μ—μ„ μ–Όλ§λ‚ λ§μ΄ μ΅μ•λ”κ°€
        - **DB μ΄μƒνƒμ§€λ” μ‹¤μ  μ΄μƒμ„ λ†“μΉλ” κ²ƒμ΄ λ”μ± μ„ν—ν•λ―€λ΅, FN μ„ μµμ†ν™”ν•λ” κ²ƒμ΄ μ¤‘μ”**
        - FP(μ •μƒμΈλ° μ΄μƒμΌλ΅ νλ‹¨)μ΄ λ§μ•„μ§€λ” κ²ƒμ΄ λ‹¨μ μ΄κ² μ§€λ§, DB λ¨λ‹ν„°λ§μ—μ„ FP λ” λ³΄ν†µ λ΅κ·Έ/μ•λμΌλ΅ λλ‚κΈ° λ•λ¬Έμ—, μ΅°κΈ λ§μ€ FP λ” κ°μ κ°€λ¥
            - **λ”°λΌμ„ FPλ„ λ§μ΄ κ³ λ ¤ν•΄μ•Όν•λ” F1-Score λ³΄λ‹¤ Recall μ„ λ³΄λ” κ²ƒμ΄ λ” μ¤‘μ”**
    - μ •λ‹µμ„ λ§μ¶”λ” ν™κ²½μ„ κµ¬ν„ν•κΈ° μ„ν•΄, μ΄μƒμΉ λ°μ΄ν„°μ— ANOMALY μ—¬λ¶€λ¥Ό μ¶”κ°€ν•΄μ„ ν‰κ°€
    """)

with tab3:
    st.markdown("\n")
    st.markdown("""
    ### 3. ν•μ΄νΌνλΌλ―Έν„° νλ‹ 
    - GridSearch λ¥Ό ν†µν• ν•μ΄νΌνλΌλ―Έν„° μµμ ν™”, ν•™μµ λ°μ΄ν„° μ¦κ°€(2λ§κ±΄ β†’ 20λ§κ±΄)
    - μ΄μƒμΉμ— λ³€ν™”λ¥Ό μ£Όμ–΄ 2%, 5%, 50%, 98% ν…μ¤νΈλ„ μ§„ν–‰ (λ¨λΈμ κ°•κ±΄μ„±κ³Ό μ μ© λ²”μ„ κ²€μ¦)
        - AutoEncoder μ μ™Έ ν¬κ² μμΉκ°€ ν”λ“¤λ¦¬λ” λ¨λΈμ€ μ—†μ—μ
        - DB μ΄μƒνƒμ§€ νΉμ„± μƒ, μ΄μƒμΉκ°€ ν¬κ² λ²—μ–΄λ‚  κ²½μ°κ°€ μ—†κΈ΄ν•¨
    """)

    st.markdown("\n")
    st.markdown("\n")
    # λ°μ΄ν„°ν”„λ μ„ μƒμ„±
    data = {
        "Anomaly %": ["2%", "", "",
                      "", "", "",
                      "", "", "",
                      "", "", ""],
        "Model": ["One-class SVM", "", "",
                  "Isolation Forest", "", "",
                  "AutoEncoder", "", "",
                  "Final Alert", "", ""],
        "Condition": ["νλ‹ μ „ (20K)", "ν•μ΄νΌνλΌλ―Έν„°νλ‹", "ν•™μµ λ°μ΄ν„° μ¦κ°€ (200K)",
                      "νλ‹ μ „ (20K)", "ν•μ΄νΌνλΌλ―Έν„°νλ‹", "ν•™μµ λ°μ΄ν„° μ¦κ°€ (200K)",
                      "νλ‹ μ „ (20K)", "ν•μ΄νΌνλΌλ―Έν„°νλ‹", "ν•™μµ λ°μ΄ν„° μ¦κ°€ (200K)",
                      "νλ‹ μ „ (20K)", "ν•μ΄νΌνλΌλ―Έν„°νλ‹", "ν•™μµ λ°μ΄ν„° μ¦κ°€ (200K)"],
        "Accuracy": ["0.9876", "0.9878 β–²0.0003", "0.9514 β–Ό0.0362",
                     "0.9741", "0.9464 β–Ό0.0278", "0.9585 β–Ό0.0157",
                     "0.9952", "0.9966 β–²0.0014", "0.9969 β–²0.0018",
                     "0.9902", "0.9883 β–Ό0.0019", "0.9924 β–²0.0022"],
        "Precision": ["0.6205", "0.6258 β–²0.0053", "0.2886 β–Ό0.3319",
                      "0.3413", "0.2674 β–Ό0.0739", "0.3219 β–Ό0.0194",
                      "1.0000", "1.0000 β‰0.0000", "1.0000 β‰0.0000",
                      "0.7409", "0.6371 β–Ό0.1038", "0.7349 β–Ό0.0060"],
        "Recall": ["0.9745", "0.9757 β–²0.0012", "0.9745 β‰0.0000",
                   "0.3148", "0.9664 β–²0.6516", "0.9734 β–²0.6586",
                   "0.7581", "0.8287 β–²0.0706", "0.8472 β–²0.0891",
                   "0.7813", "0.9653 β–²0.1840", "0.9722 β–²0.1909"],
        "F1": ["0.7582", "0.7626 β–²0.0043", "0.4453 β–Ό0.3129",
               "0.3275", "0.4189 β–²0.0914", "0.4838 β–²0.1563",
               "0.8624", "0.9063 β–²0.0439", "0.9173 β–²0.0549",
               "0.7606", "0.7676 β–²0.0070", "0.8371 β–²0.0765"],
        "Color": ["", "red", "blue",
                  "", "blue", "blue",
                  "", "red", "red",
                  "", "blue", "red"]
    }

    # λ°μ΄ν„°ν”„λ μ„ μƒμ„±
    df = pd.DataFrame(data)
    color_info = df["Color"]
    df = df.drop(columns=["Color"])


    # μ²« λ²μ§Έ ν–‰ λ¨λΈλ…μ„ κµµκ² ν‘μ‹ν•κΈ° μ„ν• ν•¨μ
    def make_bold(val, row_idx):
        if row_idx % 3 == 0:
            return f'<b>{val}</b>'
        return val


    # μƒ‰μƒκ³Ό μ¦κ° ν‘μ‹λ¥Ό μ„ν• ν•¨μ
    def color_cell(val, row_idx, col_name):
        if col_name in ["Accuracy", "Precision", "Recall", "F1"] and row_idx > 0:
            if "β–²" in val and "red" in color_info[row_idx]:
                return f'<span style="color:red">{val}</span>'
            elif "β–Ό" in val and "blue" in color_info[row_idx]:
                return f'<span style="color:blue">{val}</span>'
            elif "β‰" in val:
                return f'<span style="color:black">{val}</span>'
        return val


    # μ¤νƒ€μΌμ΄ μ μ©λ λ°μ΄ν„°ν”„λ μ„ μƒμ„±
    styled_df = pd.DataFrame()
    for col in df.columns:
        styled_df[col] = [color_cell(val, i, col) for i, val in enumerate(df[col])]

    # HTMLλ΅ ν‘μ‹
    st.write("##### μ΄μƒνƒμ§€ λ¨λΈ μ„±λ¥ λΉ„κµ κ²°κ³Ό")
    st.markdown(styled_df.to_html(escape=False, index=False), unsafe_allow_html=True)

    # λ¨λΈλ³„ μ”μ•½ μ •λ³΄
    st.markdown("""
    - **One-class SVM**: λ°μ΄ν„° μ¦κ°€ μ‹ Precisionμ΄ ν¬κ² κ°μ†
    - **Isolation Forest**: νλ‹ λ° λ°μ΄ν„° ν™•λ€ ν¨κ³Όκ°€ λ§¤μ° νΌ (νΉν Recall ν­λ°μ  μƒμΉ)
    - **AutoEncoder**: μ†λ‰ μ΄μƒμΉ ν™κ²½μ—μ„ μ•μ •μ μΌλ΅ Recall κ°μ„ 
    - **Final Alert**: νλ‹+λ°μ΄ν„° ν™•λ€ μ‹ μµκ³  μ„±λ¥μΌλ΅ μλ ΄
    """)

    # Recallμ΄ κ°€μ¥ μ¤‘μ”ν• μ§€ν‘μ„μ„ κ°•μ΅°
    st.info("μ΄μ ν™κ²½μ—μ„λ” Recall(μ¬ν„μ¨)μ„ μ°μ„ μ μΌλ΅ ν™•μΈν•΄μ•Ό ν•©λ‹λ‹¤. DB μ΄μƒνƒμ§€λ” μ‹¤μ  μ΄μƒμ„ λ†“μΉλ” κ²ƒμ΄ λ”μ± μ„ν—ν•λ―€λ΅, FNμ„ μµμ†ν™”ν•λ” κ²ƒμ΄ μ¤‘μ”ν•©λ‹λ‹¤.")
